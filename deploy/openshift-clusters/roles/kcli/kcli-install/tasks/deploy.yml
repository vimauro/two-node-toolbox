---
# OpenShift cluster deployment with kcli

- name: Set kcli deployment command
  set_fact:
    kcli_cmd: >
      kcli create cluster openshift
      --paramfile {{ kcli_params_file }}
      {{ '--debug' if kcli_debug else '' }}
      {{ test_cluster_name }}

- name: Display deployment command
  debug:
    msg: "Executing: {{ kcli_cmd }}"

- name: Deploy OpenShift cluster with kcli
  command: "{{ kcli_cmd }}"
  register: kcli_deploy_result
  async: 7200 # 2 hours timeout
  poll: 30
  environment:
    KUBECONFIG: "{{ kubeconfig_path }}"

- name: Check deployment status
  fail:
    msg: "kcli deployment failed: {{ kcli_deploy_result.stderr }}"
  when: kcli_deploy_result.rc != 0
