---
# Reusable task to ensure a libvirt pool is active

- name: Check pool status
  command: virsh pool-info {{ pool_name }}
  register: pool_status
  changed_when: false
  failed_when: false
  become: true

- name: Start pool if inactive
  command: virsh pool-start {{ pool_name }}
  become: true
  when: 
    - pool_status.rc == 0
    - "'inactive' in pool_status.stdout or 'State:' not in pool_status.stdout or 'running' not in pool_status.stdout"
  register: pool_start_result
  failed_when:
    - pool_start_result.rc != 0
    - "'is already active' not in pool_start_result.stderr"